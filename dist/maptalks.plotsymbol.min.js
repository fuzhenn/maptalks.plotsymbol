/*!
 * maptalks.plotsymbol v0.3.0
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
/*!
 * requires maptalks@>=0.44.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,a){"use strict";var x=e;function e(t,e){this.x=t,this.y=e}e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t};var c={getArrowBody:function(t,e,n,r,i){var o;e/=2;for(var s,u,a,h,c,l,p,y=0,f=[],g=[],d=1,_=t.length;d<_;d++)u=new x(t[d].x,t[d].y),a=new x(t[d-1].x,t[d-1].y),o=r&&i?(1-(1-r)*(y+=u.dist(a))/i)*e:e,h=d<_-1?new x(t[d+1].x,t[d+1].y):null,c=u.sub(a)._unit()._perp(),1===d&&(s=this._getPlotPair(t[d-1],c,e,n),f.push(s[0]),g.push(s[1])),l=h?(p=h.sub(u)._unit()._perp(),this._getJoinNormal(c,p)):c,s=this._getPlotPair(t[d],l,o,n),f.push(s[0]),g.push(s[1]);return[f,g]},_getJoinNormal:function(t,e){var n=t.add(e)._unit(),r=1/(n.x*e.x+n.y*e.y);return n._mult(r)},_getPlotPair:function(t,e,n,r){var i=e.x*n,o=e.y*n;return[t.add(i,o),t.add(-i,-o)]}};function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(e,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,e))}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var o,s=(o=a.Curve,r(u,o),u.fromJSON=function(t){var e=t.feature,n=new u(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},u.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},u.prototype._getPaintParams=function(){var e=this.getMap().getGLScale(),t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var n=this._get2DLength()*this.options.widthRatio,r=c.getArrowBody(t,n,this.getMap()),i=r[0][r[0].length-1],o=r[1][r[1].length-1],s=this._getArrowHead(i,o,t[t.length-1],n),u=[];u.push.apply(u,r[0]),u.push.apply(u,s);for(var a=r[1].length-1;0<=a;a--)u.push(r[1][a]);return[u=u.map(function(t){return t.multi(e)}),[r[0].length,s.length,r[1].length]]},u.prototype._paintOn=function(t,e,n,r,i,o){var s;t.beginPath();var u=0;t.moveTo(e[0].x,e[0].y),s=e.slice(0,n[0]),this._quadraticCurve(t,s),u+=n[0],a.Canvas._path(t,e.slice(u,u+n[1]),o,r),u+=n[1],t.lineTo(e[u].x,e[u].y),s=e.slice(u,u+n[2]),this._quadraticCurve(t,s),this._closeArrow(t,e[e.length-1],e[0]),a.Canvas._stroke(t,r),a.Canvas.fillCanvas(t,i,e[0].x,e[0].y)},u.prototype._closeArrow=function(t){t.closePath()},u.prototype._getArrowHead=function(t,e,n,r,i){i||(i=1),t=new x(t.x,t.y),e=new x(e.x,e.y);var o=t.sub(e)._unit(),s=n.add(r*o.x,r*o.y),u=n.add(r*-o.x,r*-o.y);return o._perp()._mult(-1),[s,n.add(i*r*o.x,i*r*o.y),u]},u);function u(){return n(this,u),i(this,o.apply(this,arguments))}s.mergeOptions({widthRatio:.1,arrowStyle:[]}),s.registerJSONType("StraightArrow"),a.DrawTool.registerMode("StraightArrow",{action:["click","mousemove","dblclick"],create:function(t){return new s(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var h,l=(r(p,h=s),p.fromJSON=function(t){var e=t.feature,n=new p(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},p.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},p.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var e=this.getMap().getGLScale(),n=this._get2DLength(),r=n*this.options.widthRatio,i=c.getArrowBody(t,r,this.getMap(),.15,n),o=i[0][i[0].length-1],s=i[1][i[1].length-1],u=this._getArrowHead(o,s,t[t.length-1],.3*r,2),a=[];a.push.apply(a,i[0]),a.push.apply(a,u);for(var h=i[1].length-1;0<=h;h--)a.push(i[1][h]);return[a=a.map(function(t){return t.multi(e)}),[i[0].length,u.length,i[1].length]]},p);function p(){return n(this,p),i(this,h.apply(this,arguments))}l.mergeOptions({widthRatio:.2,arrowStyle:[]}),l.registerJSONType("DiagonalArrow"),a.DrawTool.registerMode("DiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new l(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var y,f=(r(g,y=l),g.fromJSON=function(t){var e=t.feature,n=new g(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},g.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},g.prototype._closeArrow=function(t,e,n){var r=new x(e.x,e.y),i=new x(n.x,n.y),o=new x(r.x+i.x,r.y+i.y).mult(.5),s=r.dist(i),u=r.sub(i)._unit()._perp(),a=o.x+.618*s*u.x,h=o.y+.618*s*u.y;t.lineTo(a,h),t.closePath()},g);function g(){return n(this,g),i(this,y.apply(this,arguments))}f.mergeOptions({widthRatio:.2,arrowStyle:[]}),f.registerJSONType("DoveTailDiagonalArrow"),a.DrawTool.registerMode("DoveTailDiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new f(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),t.StraightArrow=s,t.DiagonalArrow=l,t.DoveTailDiagonalArrow=f,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.3.0, requires maptalks@>=0.44.0.")});