/*!
 * maptalks.plotsymbol v0.3.0
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
/*!
 * requires maptalks@>=0.44.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,gt){"use strict";var mt=e;function e(t,e){this.x=t,this.y=e}e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,o=r*this.x+e*this.y;return this.x=n,this.y=o,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),o=e.x+r*(this.x-e.x)-n*(this.y-e.y),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t};var m=Math.PI/2;function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var h=gt.Coordinate,wt=gt.Canvas;function x(t,e,r){var n=e.x*r,o=e.y*r;return[t.add(n,o),t.add(-n,-o)]}function c(t,e,r,n,o){e/=2;for(var i,a,s,u=void 0,l=0,h=[],c=[],p=void 0,y=void 0,d=void 0,f=void 0,v=void 0,g=void 0,m=void 0,w=1,P=t.length;w<P;w++)y=new mt(t[w].x,t[w].y),d=new mt(t[w-1].x,t[w-1].y),u=n&&o?(1-(1-n)*(l+=y.dist(d))/o)*e:e,f=w<P-1?new mt(t[w+1].x,t[w+1].y):null,v=y.sub(d)._unit()._perp(),1===w&&(p=x(t[w-1],v,e),h.push(p[0]),c.push(p[1])),g=f?(m=f.sub(y)._unit()._perp(),i=m,a=void 0,a=v.add(i)._unit(),s=1/(a.x*i.x+a.y*i.y),a._mult(s)):v,isNaN(g.x)||isNaN(g.y)||(p=x(t[w],g,u),h.push(p[0]),c.push(p[1]));return[h,c]}function w(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function f(r){var n=0;return r&&Array.isArray(r)&&0<r.length&&r.forEach(function(t,e){e<r.length-1&&(n+=w(t,r[e+1]))}),n}function P(t){return Math.pow(f(t),.99)}function _(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function p(t,e){var r=void 0,n=Math.asin(Math.abs(e[1]-t[1])/w(t,e));return e[1]>=t[1]&&e[0]>=t[0]?r=n+Math.PI:e[1]>=t[1]&&e[0]<t[0]?r=2*Math.PI-n:e[1]<t[1]&&e[0]<t[0]?r=n:e[1]<t[1]&&e[0]>=t[0]&&(r=Math.PI-n),r}function v(t,e,r){var n=p(e,t)-p(e,r);return n<0?n+2*Math.PI:n}function b(t,e,r){return(r[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(r[0]-t[0])}function M(t,e,r,n,o){var i=p(t,e),a=o?i+r:i-r,s=n*Math.cos(a),u=n*Math.sin(a);return[e[0]+s,e[1]+u]}function S(t,e,r,n){var o=function(t,e,r){var n=t[0]-e[0],o=t[1]-e[1],i=Math.sqrt(n*n+o*o);n/=i,o/=i;var a=r[0]-e[0],s=r[1]-e[1],u=Math.sqrt(a*a+s*s);return[n+(a/=u),o+(s/=u)]}(e,r,n),i=null,a=null,s=null,u=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=o[0]/u,h=o[1]/u,c=w(e,r),p=w(r,n);return a=1e-4<u?b(e,r,n)?(s=t*c,i=[r[0]-s*h,r[1]+s*l],s=t*p,[r[0]+s*h,r[1]-s*l]):(s=t*c,i=[r[0]+s*h,r[1]-s*l],s=t*p,[r[0]-s*h,r[1]+s*l]):(i=[r[0]+t*(e[0]-r[0]),r[1]+t*(e[1]-r[1])],[r[0]+t*(n[0]-r[0]),r[1]+t*(n[1]-r[1])]),[i,a]}function y(t){var e=1;switch(t){case t<=1:e=1;break;case 2===t:e=2;break;case 3===t:e=6;break;case 24===t:e=24;break;case 5===t:e=120;break;default:for(var r=1;r<=t;r++)e*=r}return e}function C(t){if(t.length<=2)return t;for(var e=[],r=t.length-1,n=0;n<=1;n+=.01){for(var o=0,i=0,a=0;a<=r;a++){var s=(c=a,y(h=r)/(y(c)*y(h-c))),u=Math.pow(n,a),l=Math.pow(1-n,r-a);o+=s*u*l*t[a][0],i+=s*u*l*t[a][1]}e.push([o,i])}return e.push(t[r]),e;var h,c}function A(t,e,r,n,o,i,a,s){if(!e)return null;if(e.length<=2||!n)return o&&(u=t,l=e,h=r,gt.Util.isArrayHasData(l)&&(wt._path(u,l,c,h),wt._stroke(u,h))),null;var u,l,h,c,p=e.length,y=i?p:p-1;void 0!==s&&(y-=Math.max(y-a-1,0));for(var d,f,v,g,m,w,P,x,_,b,M,S,C,A,O,T,N,k,D,J,I,G,j,q,H,L,B,E,R,W,U,F,z,V,K,Q,X,Y,Z,$,tt,et,rt,nt,ot,it=void 0,at=0;at<y;at++){var st=e[at].x,ut=e[at].y,lt=void 0,ht=void 0,ct=void 0,pt=void 0,yt=void 0,dt=void 0;ht=at-1<0?i?(lt=e[y-1].x,e[y-1].y):(lt=e[at+1].x,e[at+1].y):(lt=e[at-1].x,e[at-1].y),pt=at+1<p?(ct=e[at+1].x,e[at+1].y):(ct=e[at+1-p].x,e[at+1-p].y),dt=at+2<p?(yt=e[at+2].x,e[at+2].y):i?(yt=e[at+2-p].x,e[at+2-p].y):(yt=e[at].x,e[at].y);var ft=(H=n,L=at===y-1?s:1,void 0,B=((N=lt)+(D=st))/2,E=((k=ht)+(J=ut))/2,R=(D+(I=ct))/2,W=(J+(G=pt))/2,U=(I+(j=yt))/2,F=(G+(q=dt))/2,z=Math.sqrt((D-N)*(D-N)+(J-k)*(J-k)),V=Math.sqrt((I-D)*(I-D)+(G-J)*(G-J)),K=z/(z+V),Q=V/(V+Math.sqrt((j-I)*(j-I)+(q-G)*(q-G))),ot=[tt=(X=B+(R-B)*K)+(R-X)*H+D-X,et=(Y=E+(W-E)*K)+(W-Y)*H+J-Y,rt=(Z=R+(U-R)*Q)+(R-Z)*H+I-Z,nt=($=W+(F-W)*Q)+(W-$)*H+G-$],L<1?(T=O=A=C=S=M=void(d=0),[((v=D)*(M=1-d)*M+2*(m=tt)*d*M+(P=rt)*d*d)*(S=1-(f=L))+(m*M*M+2*P*d*M+(_=I)*d*d)*f,((g=J)*M*M+2*(w=et)*d*M+(x=nt)*d*d)*S+(w*M*M+2*x*d*M+(b=G)*d*d)*f,(C=v*S*S+2*m*f*S+P*f*f)*M+(A=m*S*S+2*P*f*S+_*f*f)*d,(O=g*S*S+2*w*f*S+x*f*f)*M+(T=w*S*S+2*x*f*S+b*f*f)*d,C*S+A*f,O*S+T*f]):ot);if(at===y-1&&0<=s&&s<1){t&&t.bezierCurveTo(ft[0],ft[1],ft[2],ft[3],ft[4],ft[5]),e.splice(y-1,p-(y-1)-1);var vt=new mt(ft[4],ft[5]);vt.prevCtrlPoint=new mt(ft[2],ft[3]),e.push(vt),p=e.length}else t&&t.bezierCurveTo(ft[0],ft[1],ft[2],ft[3],ct,pt);e[at].nextCtrlPoint=ft.slice(0,2),e[at].prevCtrlPoint=it?it.slice(2):null,it=ft}return!i&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[p-1].prevCtrlPoint||(e[p-1].prevCtrlPoint=e[p-2].nextCtrlPoint),o&&wt._stroke(t,r),e}var i,a={widthRatio:.1,arrowStyle:[],tailWidthFactor:.1,headWidthFactor:1,neckWidthFactor:.2,headAngle:Math.PI/8.5,neckAngle:Math.PI/13},s=(i=gt.Curve,r(u,i),u.fromJSON=function(t){var e=t.feature,r=new u(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},u.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},u.prototype.startEdit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t.newVertexHandleSymbol={opacity:0},i.prototype.startEdit.call(this,t)},u.prototype._getPaintParams=function(){var e=this.getMap().getGLScale(),t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var r=this._get2DLength()*this.options.widthRatio,n=c(t,r,this.getMap()),o=n[0][n[0].length-1],i=n[1][n[1].length-1],a=this._getArrowHead(o,i,t,r,1,.8,1.4,2.2,.7,2.3),s=[];s.push.apply(s,n[0]),s.push.apply(s,a);for(var u=n[1].length-1;0<=u;u--)s.push(n[1][u]);return[s=s.map(function(t){return t.multi(e)}),[n[0].length,a.length,n[1].length]]},u.prototype._paintOn=function(t,e,r,n,o,i){t.beginPath();var a=void 0,s=0;t.moveTo(e[0].x,e[0].y),a=e.slice(0,r[0]),A(t,a,n,.7,!0),s+=r[0],gt.Canvas._path(t,e.slice(s,s+r[1]),i,n),s+=r[1],a=e.slice(s,s+r[2]),A(t,a,n,.7,!0),this._closeArrow(t,e[e.length-1],e[0]),gt.Canvas._stroke(t,n),gt.Canvas.fillCanvas(t,o,e[0].x,e[0].y)},u.prototype._closeArrow=function(t){t.closePath()},u.prototype._getArrowHead=function(t,e,r,n,o,i,a,s,u,l){var h=this._getArrowHeadPoint(t,e,r[r.length-1],n*o,i,s),c=new gt.Point((h[0].x+h[1].x)/2,(h[0].y+h[1].y)/2),p=this._getArrowHeadPoint(h[0],h[1],c,n*o,a,u)[0],y=new gt.Point((h[2].x+h[1].x)/2,(h[2].y+h[1].y)/2),d=this._getArrowHeadPoint(h[2],h[1],y,n*o,a,u)[0];if(2===r.length)h=[t,p,h[1],d,e];else{var f=A(null,r,null,.8,!1),v=new gt.Point(f[f.length-1].prevCtrlPoint),g=r[r.length-1],m=g.sub(v);if(!m.x&&!m.y)return null;var w=t.distanceTo(e),P=m.unit();h=[t,p,new gt.Point(g.x+P.x*w*l,g.y+P.y*w*l),d,e]}return h},u.prototype._getArrowHeadPoint=function(t,e,r,n,o,i){i||(i=1),t=new mt(t.x,t.y),e=new mt(e.x,e.y);var a=t.sub(e)._unit(),s=r.add(n*a.x*o,n*a.y*o),u=r.add(n*-a.x*o,n*-a.y*o);return a._perp()._mult(-1),[s,r.add(i*n*a.x,i*n*a.y),u]},u);function u(){return n(this,u),o(this,i.apply(this,arguments))}s.mergeOptions(a),s.registerJSONType("StraightArrow"),gt.DrawTool.registerMode("StraightArrow",{action:["click","mousemove","dblclick"],create:function(t){return new s(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var l,d=(r(g,l=s),g.fromJSON=function(t){var e=t.feature,r=new g(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},g.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},g.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var e=this.getMap().getGLScale(),r=this._get2DLength(),n=r*this.options.widthRatio,o=c(t,n,this.getMap(),.15,r),i=o[0][o[0].length-1],a=o[1][o[1].length-1],s=this._getArrowHead(i,a,t,n,.3,.6,1.4,2.2,.8,3.3),u=[];u.push.apply(u,o[0]),u.push.apply(u,s);for(var l=o[1].length-1;0<=l;l--)u.push(o[1][l]);return[u=u.map(function(t){return t.multi(e)}),[o[0].length,s.length,o[1].length]]},g);function g(){return n(this,g),o(this,l.apply(this,arguments))}d.mergeOptions({widthRatio:.2,arrowStyle:[]}),d.registerJSONType("DiagonalArrow"),gt.DrawTool.registerMode("DiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new d(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var O,T=(r(N,O=d),N.fromJSON=function(t){var e=t.feature,r=new N(e.geometry.coordinates,t.options);return r.setProperties(e.properties),r},N.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},N.prototype._closeArrow=function(t,e,r){var n=this.getMap().getPitch(),o=new mt(e.x,e.y),i=new mt(r.x,r.y),a=new mt(o.x+i.x,o.y+i.y).mult(.5),s=o.dist(i),u=o.sub(i)._unit()._perp(),l=.618-.518*n/80,h=a.x+s*l*u.x,c=a.y+s*l*u.y;t.lineTo(h,c),t.closePath()},N);function N(){return n(this,N),o(this,O.apply(this,arguments))}T.mergeOptions({widthRatio:.2,arrowStyle:[]}),T.registerJSONType("DoveTailDiagonalArrow"),gt.DrawTool.registerMode("DoveTailDiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new T(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var k,D=(k=gt.Curve,r(J,k),J.prototype.startEdit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t.newVertexHandleSymbol={opacity:0},k.prototype.startEdit.call(this,t)},J.prototype._getPaintParams=function(){var e=this.getMap().getGLScale(),t=this._generate();if(!t)return null;if(!this._getProjection())return null;this._verifyProjection();var r=this._projectCoords(t),n=this._getPath2DPoints(r);return[n=n.map(function(t){return t.multi(e)}),[]]},J.prototype._paintOn=function(t,e,r,n,o){if(!(e.length<=0)){t.strokeStyle=this.getSymbol().lineColor||"#f00",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),gt.Canvas._stroke(t,n),gt.Canvas.fillCanvas(t,o,e[0].x,e[0].y)}},J);function J(){return n(this,J),o(this,k.apply(this,arguments))}var I,G=.25,j=.3,q=.85,H=.15,L=(r(B,I=D),B.prototype._generate=function(){var t=this.getCoordinates(),e=t.length,r=gt.Coordinate.toNumberArrays(t);if(e<2)return null;if(2===e)return this.setCoordinates(t),null;var n=[r[0],r[1],r[2]],o=n[0],i=n[1],a=n[2];3===e?(this.symmetricalPoints=B.getSymmetricalPoints(o,i,a),this.connetPoints=_(o,i)):4===e?(this.symmetricalPoints=r[3],this.connetPoints=_(o,i)):4<e&&this._drawTool.disable();var s=void 0,u=void 0;u=b(o,i,a)?(s=B.getArrowPoints(o,this.connetPoints,this.symmetricalPoints,!1),B.getArrowPoints(this.connetPoints,i,a,!0)):(s=B.getArrowPoints(i,this.connetPoints,a,!1),B.getArrowPoints(this.connetPoints,o,this.symmetricalPoints,!0));var l=s.length,h=(l-5)/2,c=s.slice(0,h),p=s.slice(h,5+h),y=s.slice(5+h,l),d=u.slice(0,h),f=u.slice(h,5+h),v=u.slice(5+h,l);d=C(d);var g=C(v.concat(c.slice(1)));return y=C(y),d.concat(f,g,p,y).map(function(t){return new gt.Coordinate(t)})},B.prototype.getPlotType=function(){return this.type},B.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:gt.Coordinate.toNumberArrays([this.getShell()])}},B.prototype._toJSON=function(t){var e=gt.Util.extend({},t),r=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"DoubleArrow",coordinates:r}},B.getArrowPoints=function(t,e,r,n){var o=_(t,e),i=w(o,r),a=M(r,o,0,.3*i,!0),s=M(r,o,0,.5*i,!0),u=[o,a=M(o,a,m,i/5,n),s=M(o,s,m,i/4,n),r],l=B._getArrowHeadPoints(u);if(l&&Array.isArray(l)&&0<l.length){var h=[l[0],l[4]],c=h[0],p=h[1],y=w(t,e)/P(u)/2,d=B._getArrowBodyPoints(u,c,p,y);if(d){var f=d.length,v=d.slice(0,f/2),g=d.slice(f/2,f);return v.push(c),g.push(p),(v=v.reverse()).push(e),(g=g.reverse()).push(t),v.reverse().concat(l,g)}}return null},B._getArrowHeadPoints=function(t){var e=P(t)*G,r=t[t.length-1],n=e*j,o=e*H,i=e*q,a=M(t[t.length-2],r,0,e,!0),s=M(t[t.length-2],r,0,i,!0),u=M(r,a,m,n,!1),l=M(r,a,m,n,!0);return[M(r,s,m,o,!1),u,r,l,M(r,s,m,o,!0)]},B._getArrowBodyPoints=function(t,e,r,n){for(var o=f(t),i=P(t)*n,a=(i-w(e,r))/2,s=0,u=[],l=[],h=1;h<t.length-1;h++){var c=v(t[h-1],t[h],t[h+1])/2,p=(i/2-(s+=w(t[h-1],t[h]))/o*a)/Math.sin(c),y=M(t[h-1],t[h],Math.PI-c,p,!0),d=M(t[h-1],t[h],c,p,!1);u.push(y),l.push(d)}return u.concat(l)},B.getSymmetricalPoints=function(t,e,r){var n=_(t,e),o=w(n,r),i=v(t,n,r),a=void 0,s=void 0,u=void 0;return i<m?(a=o*Math.sin(i),s=o*Math.cos(i),u=M(t,n,m,a,!1),M(n,u,m,s,!0)):m<=i&&i<Math.PI?(a=o*Math.sin(Math.PI-i),s=o*Math.cos(Math.PI-i),u=M(t,n,m,a,!1),M(n,u,m,s,!1)):i>=Math.PI&&i<1.5*Math.PI?(a=o*Math.sin(i-Math.PI),s=o*Math.cos(i-Math.PI),u=M(t,n,m,a,!0),M(n,u,m,s,!0)):(a=o*Math.sin(2*Math.PI-i),s=o*Math.cos(2*Math.PI-i),u=M(t,n,m,a,!0),M(n,u,m,s,!1))},B.fromJSON=function(t){var e=t.feature,r=new B(t.coordinates,t.options);return r.setProperties(e.properties),r},B);function B(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,B);var r=o(this,I.call(this,t,e));return r.type="DoubleArrow",r.connetPoints=[],r.symmetricalPoints=[],r}L.registerJSONType("DoubleArrow"),gt.DrawTool.registerMode("DoubleArrow",{action:["click","mousemove","dblclick"],create:function(t){return new gt.LineString(t)},update:function(t,e,r){var n=e.getSymbol();e.setCoordinates(t);var o=e.getLayer();if(o){var i=o.getGeometryById("doublearrow");!i&&3<=t.length&&((i=new L(t,{id:"doublearrow"}))._drawTool=r.drawTool,i.addTo(o),n&&i.setSymbol(n),e.updateSymbol({lineOpacity:0})),i&&(i.setCoordinates(t),e.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return 4<r.length&&(r=r.slice(0,4)),new L(r,{symbol:e})}});var E,R=(r(W,E=D),W.prototype.getPlotType=function(){return this.type},W.prototype._generate=function(){var t=this.getCoordinates(),e=t.length;if(e<2)return null;if(2===e)return this.setCoordinates(t),null;var r=gt.Coordinate.toNumberArrays(t);r.push(r[0],r[1]);for(var n=[],o=[],i=0;i<r.length-2;i++){var a=S(this._offset,r[i],r[i+1],r[i+2]);n=n.concat(a)}var s,u,l,h,c,p,y,d,f,v,g=n.length;n=[n[g-1]].concat(n.slice(0,g-1));for(var m=0;m<r.length-2;m++){var w=r[m],P=r[m+1];o.push(w);for(var x=0;x<=100;x++){var _=(s=x/100,u=w,l=n[2*m],h=n[2*m+1],c=P,p=1-(s=Math.max(Math.min(s,1),0)),d=(y=s*s)*s,[(v=(f=p*p)*p)*u[0]+3*f*s*l[0]+3*p*y*h[0]+d*c[0],v*u[1]+3*f*s*l[1]+3*p*y*h[1]+d*c[1]]);o.push(_)}o.push(P)}return o=o.map(function(t){return new gt.Coordinate(t)})},W.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:gt.Coordinate.toNumberArrays([this.getShell()])}},W.prototype._toJSON=function(t){var e=gt.Util.extend({},t),r=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"ClosedCurve",coordinates:r}},W.fromJSON=function(t){var e=t.feature,r=new W(t.coordinates,t.options);return r.setProperties(e.properties),r},W);function W(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,W);var r=o(this,E.call(this,t,e));return r.type="ClosedCurve",r._offset=.3,t&&r.setCoordinates(t),r}R.registerJSONType("ClosedCurve"),gt.DrawTool.registerMode("ClosedCurve",{action:["click","mousemove","dblclick"],create:function(t){return new gt.LineString(t)},update:function(t,e){var r=e.getSymbol();e.setCoordinates(t);var n=e.getLayer();if(n){var o=n.getGeometryById("closedcurve");!o&&3<=t.length&&((o=new R([t],{id:"closedcurve"})).addTo(n),r&&o.setSymbol(r),e.updateSymbol({lineOpacity:0})),o&&(o.setCoordinates(t),e.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();return e.lineOpacity=1,new R(t.getCoordinates(),{symbol:e})}});var U,F=(r(z,U=D),z.prototype.getPlotType=function(){return this.type},z.prototype._generate=function(){var t=[],e=this.getCoordinates(),r=e.length,n=gt.Coordinate.toNumberArrays(e);if(r<=2)return this.setCoordinates(n),null;if(3===r){var o=[n[0],n[1],n[2]],i=o[0],a=o[1],s=o[2],u=this._getMeasurer(),l=function(t,e,r,n,o){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:100,a=null,s=null,u=o-n,l=[];u=u<0?u+2*Math.PI:u;for(var h=0;h<i;h++){var c=u*h/i+n;a=r*Math.cos(c),s=r*Math.sin(c);var p=t.locate({x:e[0],y:e[1]},a,s);l.push([p.x,p.y])}return l}(u,i,function(t,e,r){return t.measureLength(h.toCoordinates(e),h.toCoordinates(r))}(u,a,i),p(a,i),p(s,i));l.push(i,l[0]),t=l.map(function(t){return new gt.Coordinate(t)})}else 3<r&&this._drawTool.endDraw();return t},z.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:gt.Coordinate.toNumberArrays([this.getShell()])}},z.prototype._toJSON=function(t){var e=gt.Util.extend({},t),r=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Sector",coordinates:r}},z.fromJSON=function(t){var e=t.feature,r=new z(t.coordinates,t.options);return r.setProperties(e.properties),r},z);function z(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,z);var r=o(this,U.call(this,t,e));return r.type="Sector",t&&r.setCoordinates(t),r}F.registerJSONType("Sector"),gt.DrawTool.registerMode("Sector",{action:["click","mousemove","dblclick"],create:function(t){return new gt.LineString(t)},update:function(t,e,r){var n=e.getSymbol();e.setCoordinates(t);var o=e.getLayer();if(o){var i=o.getGeometryById("sector");if(!i&&3<=t.length){(i=new F(t,{id:"sector"}))._drawTool=r.drawTool,i.addTo(o);var a=gt.Util.extendSymbol(n,{});a&&i.setSymbol(a),e.updateSymbol({lineOpacity:0})}i&&(i.setCoordinates(t),e.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return 3<r.length&&(r=r.slice(0,3)),new F(r,{symbol:e})}}),t.StraightArrow=s,t.DiagonalArrow=d,t.DoveTailDiagonalArrow=T,t.DoubleArrow=L,t.ClosedCurve=R,t.Sector=F,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.3.0, requires maptalks@>=0.44.0.")});