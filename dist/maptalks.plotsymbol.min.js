/*!
 * maptalks.plotsymbol v0.5.0
 * LICENSE : MIT
 * (c) 2016-2020 maptalks.org
 */
/*!
 * requires maptalks@>=0.44.1 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(t,e){this.x=t,this.y=e}function n(t,e){var r=t.add(e)._unit(),n=1/(r.x*e.x+r.y*e.y);return r._mult(n)}function o(t,e,r){var n=e.x*r,o=e.y*r;return[t.add(n,o),t.add(-n,-o)]}var i=r;r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,o=r*this.x+e*this.y;return this.x=n,this.y=o,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),o=e.x+r*(this.x-e.x)-n*(this.y-e.y),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t};var a=Math.PI/2,s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))},h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=e.Coordinate,c=e.Canvas,p=function(t,e,r,a,s){e/=2;for(var u=void 0,h=0,l=[],c=[],p=void 0,y=void 0,d=void 0,f=void 0,v=void 0,g=void 0,m=1,P=t.length;m<P;m++)y=new i(t[m].x,t[m].y),d=new i(t[m-1].x,t[m-1].y),u=a&&s?(1-(1-a)*(h+=y.dist(d))/s)*e:e,f=m<P-1?new i(t[m+1].x,t[m+1].y):null,v=y.sub(d)._unit()._perp(),1===m&&(p=o(t[m-1],v,e),l.push(p[0]),c.push(p[1])),g=f?n(v,f.sub(y)._unit()._perp()):v,isNaN(g.x)||isNaN(g.y)||(p=o(t[m],g,u),l.push(p[0]),c.push(p[1]));return[l,c]},y=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},d=function(t){var e=0;return t&&Array.isArray(t)&&t.length>0&&t.forEach(function(r,n){n<t.length-1&&(e+=y(r,t[n+1]))}),e},f=function(t){return Math.pow(d(t),.99)},v=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},g=function(t,e){var r=void 0,n=Math.asin(Math.abs(e[1]-t[1])/y(t,e));return e[1]>=t[1]&&e[0]>=t[0]?r=n+Math.PI:e[1]>=t[1]&&e[0]<t[0]?r=2*Math.PI-n:e[1]<t[1]&&e[0]<t[0]?r=n:e[1]<t[1]&&e[0]>=t[0]&&(r=Math.PI-n),r},m=function(t,e,r){var n=g(e,t)-g(e,r);return n<0?n+2*Math.PI:n},P=function(t,e,r){return(r[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(r[0]-t[0])},w=function(t,e,r,n,o){var i=1-(t=Math.max(Math.min(t,1),0)),a=t*t,s=a*t,u=i*i,h=u*i;return[h*e[0]+3*u*t*r[0]+3*i*a*n[0]+s*o[0],h*e[1]+3*u*t*r[1]+3*i*a*n[1]+s*o[1]]},_=function(t,e,r,n,o){var i=g(t,e),a=o?i+r:i-r,s=n*Math.cos(a),u=n*Math.sin(a);return[e[0]+s,e[1]+u]},x=function(t,e,r,n){var o=function(t,e,r){var n=t[0]-e[0],o=t[1]-e[1],i=Math.sqrt(n*n+o*o);n/=i,o/=i;var a=r[0]-e[0],s=r[1]-e[1],u=Math.sqrt(a*a+s*s);return[n+(a/=u),o+(s/=u)]}(e,r,n),i=null,a=null,s=null,u=Math.sqrt(o[0]*o[0]+o[1]*o[1]),h=o[0]/u,l=o[1]/u,c=y(e,r),p=y(r,n);return u>1e-4?P(e,r,n)?(s=t*c,i=[r[0]-s*l,r[1]+s*h],s=t*p,a=[r[0]+s*l,r[1]-s*h]):(s=t*c,i=[r[0]+s*l,r[1]-s*h],s=t*p,a=[r[0]-s*l,r[1]+s*h]):(i=[r[0]+t*(e[0]-r[0]),r[1]+t*(e[1]-r[1])],a=[r[0]+t*(n[0]-r[0]),r[1]+t*(n[1]-r[1])]),[i,a]},C=function(t){var e=1;switch(t){case t<=1:e=1;break;case 2===t:e=2;break;case 3===t:e=6;break;case 24===t:e=24;break;case 5===t:e=120;break;default:for(var r=1;r<=t;r++)e*=r}return e},b=function(t,e){return C(t)/(C(e)*C(t-e))},M=function(t){if(t.length<=2)return t;for(var e=[],r=t.length-1,n=0;n<=1;n+=.01){for(var o=0,i=0,a=0;a<=r;a++){var s=b(r,a),u=Math.pow(n,a),h=Math.pow(1-n,r-a);o+=s*u*h*t[a][0],i+=s*u*h*t[a][1]}e.push([o,i])}return e.push(t[r]),e},S=function(t,r,n,o,a,s,u,h){function l(t,e,r,n,o,i,a,s,u,h){var l=(t+r)/2,c=(e+n)/2,p=(r+o)/2,y=(n+i)/2,d=(o+a)/2,f=(i+s)/2,v=Math.sqrt((r-t)*(r-t)+(n-e)*(n-e)),g=Math.sqrt((o-r)*(o-r)+(i-n)*(i-n)),m=v/(v+g),P=g/(g+Math.sqrt((a-o)*(a-o)+(s-i)*(s-i))),w=l+(p-l)*m,_=c+(y-c)*m,x=p+(d-p)*P,C=y+(f-y)*P,b=w+(p-w)*u+r-w,M=_+(y-_)*u+n-_,S=x+(p-x)*u+o-x,A=C+(y-C)*u+i-C,O=[b,M,S,A];return h<1?function(t,e,r,n,o,i,a,s,u,h){var l=1-t,c=1-e,p=r*c*c+2*o*e*c+a*e*e,y=o*c*c+2*a*e*c+u*e*e,d=n*c*c+2*i*e*c+s*e*e,f=i*c*c+2*s*e*c+h*e*e;return[(r*l*l+2*o*t*l+a*t*t)*c+(o*l*l+2*a*t*l+u*t*t)*e,(n*l*l+2*i*t*l+s*t*t)*c+(i*l*l+2*s*t*l+h*t*t)*e,p*l+y*t,d*l+f*t,p*c+y*e,d*c+f*e]}(0,h,r,n,b,M,S,A,o,i):O}if(!r)return null;if(r.length<=2||!o)return a&&function(t,r,n,o,i){e.Util.isArrayHasData(r)&&(c._path(t,r,i,n),c._stroke(t,n))}(t,r,n),null;var p=r.length,y=s?p:p-1;void 0!==h&&(y-=Math.max(y-u-1,0));for(var d=void 0,f=0;f<y;f++){var v=r[f].x,g=r[f].y,m=void 0,P=void 0,w=void 0,_=void 0,x=void 0,C=void 0;f-1<0?s?(m=r[y-1].x,P=r[y-1].y):(m=r[f+1].x,P=r[f+1].y):(m=r[f-1].x,P=r[f-1].y),f+1<p?(w=r[f+1].x,_=r[f+1].y):(w=r[f+1-p].x,_=r[f+1-p].y),f+2<p?(x=r[f+2].x,C=r[f+2].y):s?(x=r[f+2-p].x,C=r[f+2-p].y):(x=r[f].x,C=r[f].y);var b=l(m,P,v,g,w,_,x,C,o,f===y-1?h:1);if(f===y-1&&h>=0&&h<1){t&&t.bezierCurveTo(b[0],b[1],b[2],b[3],b[4],b[5]),r.splice(y-1,p-(y-1)-1);var M=new i(b[4],b[5]);M.prevCtrlPoint=new i(b[2],b[3]),r.push(M),p=r.length}else t&&t.bezierCurveTo(b[0],b[1],b[2],b[3],w,_);r[f].nextCtrlPoint=b.slice(0,2),r[f].prevCtrlPoint=d?d.slice(2):null,d=b}return!s&&r[1].prevCtrlPoint&&(r[0].nextCtrlPoint=r[1].prevCtrlPoint,delete r[0].prevCtrlPoint),r[p-1].prevCtrlPoint||(r[p-1].prevCtrlPoint=r[p-2].nextCtrlPoint),a&&c._stroke(t,n),r},A={widthRatio:.1,arrowStyle:[],tailWidthFactor:.1,headWidthFactor:1,neckWidthFactor:.2,headAngle:Math.PI/8.5,neckAngle:Math.PI/13},O=function(t){function r(){return s(this,r),h(this,t.apply(this,arguments))}return u(r,t),r.fromJSON=function(t){var e=t.feature,n=new r(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},r.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},r.prototype.startEdit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.newVertexHandleSymbol={opacity:0},t.prototype.startEdit.call(this,e)},r.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),e=this._getPath2DPoints(this._getPrjCoordinates());if(e.length<=1)return null;var r=this._get2DLength()*this.options.widthRatio,n=p(e,r,this.getMap()),o=n[0][n[0].length-1],i=n[1][n[1].length-1],a=this._getArrowHead(o,i,e,r,1,.8,1.4,2.2,.7,2.3),s=[];s.push.apply(s,n[0]),s.push.apply(s,a);for(var u=n[1].length-1;u>=0;u--)s.push(n[1][u]);return s=s.map(function(e){return e.multi(t)}),[s,[n[0].length,a.length,n[1].length]]},r.prototype._paintOn=function(t,r,n,o,i,a){t.beginPath();var s=void 0,u=0;t.moveTo(r[0].x,r[0].y),s=r.slice(0,n[0]),S(t,s,o,.7,!0),u+=n[0],e.Canvas._path(t,r.slice(u,u+n[1]),a,o),u+=n[1],s=r.slice(u,u+n[2]),S(t,s,o,.7,!0),this._closeArrow(t,r[r.length-1],r[0]),e.Canvas._stroke(t,o),e.Canvas.fillCanvas(t,i,r[0].x,r[0].y)},r.prototype._closeArrow=function(t){t.closePath()},r.prototype._getArrowHead=function(t,r,n,o,i,a,s,u,h,l){var c=this._getArrowHeadPoint(t,r,n[n.length-1],o*i,a,u),p=new e.Point((c[0].x+c[1].x)/2,(c[0].y+c[1].y)/2),y=this._getArrowHeadPoint(c[0],c[1],p,o*i,s,h)[0],d=new e.Point((c[2].x+c[1].x)/2,(c[2].y+c[1].y)/2),f=this._getArrowHeadPoint(c[2],c[1],d,o*i,s,h)[0],v=void 0;if(2===n.length)v=[t,y,c[1],f,r];else{var g=S(null,n,null,.8,!1),m=new e.Point(g[g.length-1].prevCtrlPoint),P=n[n.length-1],w=P.sub(m);if(0===w.x&&0===w.y)return[t,y,c[1],f,r];var _=t.distanceTo(r),x=w.unit();v=[t,y,new e.Point(P.x+x.x*_*l,P.y+x.y*_*l),f,r]}return v},r.prototype._getArrowHeadPoint=function(t,e,r,n,o,a){a||(a=1),t=new i(t.x,t.y),e=new i(e.x,e.y);var s=t.sub(e)._unit(),u=r.add(n*s.x*o,n*s.y*o),h=r.add(n*-s.x*o,n*-s.y*o);s._perp()._mult(-1);return[u,r.add(a*n*s.x,a*n*s.y),h]},r}(e.Curve);O.mergeOptions(A),O.registerJSONType("StraightArrow"),e.DrawTool.registerMode("StraightArrow",{action:["click","mousemove","dblclick"],create:function(t){return new O(t)},update:function(t,e,r){var n=void 0;Array.isArray(e)?n=e:(n=r._getPrjCoordinates()).push(e);var o=n.map(function(e){return t.unproject(e)});r.setCoordinates(o),r._setPrjCoordinates(n)},generate:function(t){return t}});var T=function(t){function e(){return s(this,e),h(this,t.apply(this,arguments))}return u(e,t),e.fromJSON=function(t){var r=t.feature,n=new e(r.geometry.coordinates,t.options);return n.setProperties(r.properties),n},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},e.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var e=this.getMap().getGLScale(),r=this._get2DLength(),n=r*this.options.widthRatio,o=p(t,n,this.getMap(),.15,r),i=o[0][o[0].length-1],a=o[1][o[1].length-1],s=this._getArrowHead(i,a,t,n,.3,.6,1.4,2.2,.8,3.3),u=[];u.push.apply(u,o[0]),u.push.apply(u,s);for(var h=o[1].length-1;h>=0;h--)u.push(o[1][h]);return u=u.map(function(t){return t.multi(e)}),[u,[o[0].length,s.length,o[1].length]]},e}(O);T.mergeOptions({widthRatio:.2,arrowStyle:[]}),T.registerJSONType("DiagonalArrow"),e.DrawTool.registerMode("DiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new T(t)},update:function(t,e,r){var n=void 0;Array.isArray(e)?n=e:(n=r._getPrjCoordinates()).push(e);var o=n.map(function(e){return t.unproject(e)});r.setCoordinates(o),r._setPrjCoordinates(n)},generate:function(t){return t}});var N=function(t){function e(){return s(this,e),h(this,t.apply(this,arguments))}return u(e,t),e.fromJSON=function(t){var r=t.feature,n=new e(r.geometry.coordinates,t.options);return n.setProperties(r.properties),n},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},e.prototype._closeArrow=function(t,e,r){var n=this.getMap().getPitch(),o=new i(e.x,e.y),a=new i(r.x,r.y),s=new i(o.x+a.x,o.y+a.y).mult(.5),u=-o.dist(a),h=o.sub(a)._unit()._perp(),l=.618-.518*n/80,c=s.x+u*l*h.x,p=s.y+u*l*h.y;t.lineTo(c,p),t.closePath()},e}(T);N.mergeOptions({widthRatio:.2,arrowStyle:[]}),N.registerJSONType("DoveTailDiagonalArrow"),e.DrawTool.registerMode("DoveTailDiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new N(t)},update:function(t,e,r){var n=void 0;Array.isArray(e)?n=e:(n=r._getPrjCoordinates()).push(e);var o=n.map(function(e){return t.unproject(e)});r.setCoordinates(o),r._setPrjCoordinates(n)},generate:function(t){return t}});var j=function(t){function r(){return s(this,r),h(this,t.apply(this,arguments))}return u(r,t),r.prototype.startEdit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.newVertexHandleSymbol={opacity:0},t.prototype.startEdit.call(this,e)},r.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),e=this._generate();if(!e)return null;if(!this._getProjection())return null;this._verifyProjection();var r=this._projectCoords(e),n=this._getPath2DPoints(r);return n=n.map(function(e){return e.multi(t)}),[n,[]]},r.prototype._paintOn=function(t,r,n,o,i){if(!(r.length<=0)){t.strokeStyle=this.getSymbol().lineColor||"#f00",t.beginPath(),t.moveTo(r[0].x,r[0].y);for(var a=1;a<r.length;a++)t.lineTo(r[a].x,r[a].y);t.closePath(),e.Canvas._stroke(t,o),e.Canvas.fillCanvas(t,i,r[0].x,r[0].y)}},r}(e.Curve),k=.25,D=.3,J=.85,I=.15,G=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=h(this,t.call(this,e,n));return o.type="DoubleArrow",o.connetPoints=[],o.symmetricalPoints=[],o}return u(r,t),r.prototype._generate=function(){var t=this.getCoordinates(),n=t.length,o=e.Coordinate.toNumberArrays(t);if(n<2)return null;if(2===n)return this.setCoordinates(t),null;var i=[o[0],o[1],o[2]],a=i[0],s=i[1],u=i[2];3===n?(this.symmetricalPoints=r.getSymmetricalPoints(a,s,u),this.connetPoints=v(a,s)):4===n?(this.symmetricalPoints=o[3],this.connetPoints=v(a,s)):n>4&&this._drawTool.disable();var h=void 0,l=void 0;P(a,s,u)?(h=r.getArrowPoints(a,this.connetPoints,this.symmetricalPoints,!1),l=r.getArrowPoints(this.connetPoints,s,u,!0)):(h=r.getArrowPoints(s,this.connetPoints,u,!1),l=r.getArrowPoints(this.connetPoints,a,this.symmetricalPoints,!0));var c=h.length,p=(c-5)/2,y=h.slice(0,p),d=h.slice(p,p+5),f=h.slice(p+5,c),g=l.slice(0,p),m=l.slice(p,p+5),w=l.slice(p+5,c);g=M(g);var _=M(w.concat(y.slice(1)));return f=M(f),g.concat(m,_,d,f).map(function(t){return new e.Coordinate(t)})},r.prototype.getPlotType=function(){return this.type},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"DoubleArrow",coordinates:n}},r.getArrowPoints=function(t,e,n,o){var i=v(t,e),s=y(i,n),u=_(n,i,0,.3*s,!0),h=_(n,i,0,.5*s,!0),l=[i,u=_(i,u,a,s/5,o),h=_(i,h,a,s/4,o),n],c=r._getArrowHeadPoints(l);if(c&&Array.isArray(c)&&c.length>0){var p=[c[0],c[4]],d=p[0],g=p[1],m=y(t,e)/f(l)/2,P=r._getArrowBodyPoints(l,d,g,m);if(P){var w=P.length,x=P.slice(0,w/2),C=P.slice(w/2,w);return x.push(d),C.push(g),(x=x.reverse()).push(e),(C=C.reverse()).push(t),x.reverse().concat(c,C)}}return null},r._getArrowHeadPoints=function(t){var e=f(t)*k,r=t[t.length-1],n=e*D,o=e*I,i=e*J,s=_(t[t.length-2],r,0,e,!0),u=_(t[t.length-2],r,0,i,!0),h=_(r,s,a,n,!1),l=_(r,s,a,n,!0);return[_(r,u,a,o,!1),h,r,l,_(r,u,a,o,!0)]},r._getArrowBodyPoints=function(t,e,r,n){for(var o=d(t),i=f(t)*n,a=(i-y(e,r))/2,s=0,u=[],h=[],l=1;l<t.length-1;l++){var c=m(t[l-1],t[l],t[l+1])/2,p=(i/2-(s+=y(t[l-1],t[l]))/o*a)/Math.sin(c),v=_(t[l-1],t[l],Math.PI-c,p,!0),g=_(t[l-1],t[l],c,p,!1);u.push(v),h.push(g)}return u.concat(h)},r.getSymmetricalPoints=function(t,e,r){var n=v(t,e),o=y(n,r),i=m(t,n,r),s=void 0,u=void 0,h=void 0,l=void 0;return i<a?(u=o*Math.sin(i),h=o*Math.cos(i),l=_(t,n,a,u,!1),s=_(n,l,a,h,!0)):i>=a&&i<Math.PI?(u=o*Math.sin(Math.PI-i),h=o*Math.cos(Math.PI-i),l=_(t,n,a,u,!1),s=_(n,l,a,h,!1)):i>=Math.PI&&i<1.5*Math.PI?(u=o*Math.sin(i-Math.PI),h=o*Math.cos(i-Math.PI),l=_(t,n,a,u,!0),s=_(n,l,a,h,!0)):(u=o*Math.sin(2*Math.PI-i),h=o*Math.cos(2*Math.PI-i),l=_(t,n,a,u,!0),s=_(n,l,a,h,!1)),s},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(j);G.registerJSONType("DoubleArrow"),e.DrawTool.registerMode("DoubleArrow",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,e,r,n){var o=r.getSymbol(),i=void 0;Array.isArray(e)?i=e:(i=r._getPrjCoordinates()).push(e);var a=i.map(function(e){return t.unproject(e)});r.setCoordinates(a),r._setPrjCoordinates(i);var s=r.getLayer();if(s){var u=s.getMap(),h=s.getGeometryById("doublearrow");!h&&e.length>=3&&((h=new G(e,{id:"doublearrow"}))._drawTool=n.drawTool||u._map_tool,h.addTo(s),o&&h.setSymbol(o),r.updateSymbol({lineOpacity:0})),h&&(h.setCoordinates(a),h._setPrjCoordinates(e),r.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return r.length>4&&(r=r.slice(0,4)),new G(r,{symbol:e})}});var q=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=h(this,t.call(this,e,n));return o.type="ClosedCurve",o._offset=.3,e&&o.setCoordinates(e),o}return u(r,t),r.prototype.getPlotType=function(){return this.type},r.prototype._generate=function(){var t=this.getCoordinates(),r=t.length;if(r<2)return null;if(2===r)return this.setCoordinates(t),null;var n=e.Coordinate.toNumberArrays(t);n.push(n[0],n[1]);for(var o=[],i=[],a=0;a<n.length-2;a++){var s=x(this._offset,n[a],n[a+1],n[a+2]);o=o.concat(s)}var u=o.length;o=[o[u-1]].concat(o.slice(0,u-1));for(var h=0;h<n.length-2;h++){var l=n[h],c=n[h+1];i.push(l);for(var p=0;p<=100;p++){var y=w(p/100,l,o[2*h],o[2*h+1],c);i.push(y)}i.push(c)}return i=i.map(function(t){return new e.Coordinate(t)})},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"ClosedCurve",coordinates:n}},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(j);q.registerJSONType("ClosedCurve"),e.DrawTool.registerMode("ClosedCurve",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,e,r){var n=r.getSymbol(),o=void 0;Array.isArray(e)?o=e:(o=r._getPrjCoordinates()).push(e);var i=o.map(function(e){return t.unproject(e)});r.setCoordinates(i),r._setPrjCoordinates(o);var a=r.getLayer();if(a){var s=a.getGeometryById("closedcurve");!s&&e.length>=3&&((s=new q([e],{id:"closedcurve"})).addTo(a),n&&s.setSymbol(n),r.updateSymbol({lineOpacity:0})),s&&(s.setCoordinates(i),s._setPrjCoordinates(e),r.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();return e.lineOpacity=1,new q(t.getCoordinates(),{symbol:e})}});var H=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=h(this,t.call(this,e,n));return o.type="Sector",e&&o.setCoordinates(e),o}return u(r,t),r.prototype.getPlotType=function(){return this.type},r.prototype._generate=function(){var t=[],r=this.getCoordinates(),n=r.length,o=e.Coordinate.toNumberArrays(r);if(n<=2)return this.setCoordinates(o),null;if(3===n){var i=[o[0],o[1],o[2]],a=i[0],s=i[1],u=i[2],h=this._getMeasurer(),c=function(t,e,r,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=null,s=null,u=o-n,h=[];u=u<0?u+2*Math.PI:u;for(var l=0;l<i;l++){var c=u*l/i+n;a=r*Math.cos(c),s=r*Math.sin(c);var p=t.locate({x:e[0],y:e[1]},a,s);h.push([p.x,p.y])}return h}(h,a,function(t,e,r){return t.measureLength(l.toCoordinates(e),l.toCoordinates(r))}(h,s,a),g(s,a),g(u,a));c.push(a,c[0]),t=c.map(function(t){return new e.Coordinate(t)})}else n>3&&this._drawTool.endDraw();return t},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"Sector",coordinates:n}},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(j);H.registerJSONType("Sector"),e.DrawTool.registerMode("Sector",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,r,n,o){var i=n.getSymbol(),a=void 0;Array.isArray(r)?a=r:(a=n._getPrjCoordinates()).push(r);var s=a.map(function(e){return t.unproject(e)});n.setCoordinates(s),n._setPrjCoordinates(a);var u=n.getLayer();if(u){var h=u.getMap(),l=u.getGeometryById("sector");if(!l&&r.length>=3){(l=new H(r,{id:"sector"}))._drawTool=o.drawTool||h._map_tool,l.addTo(u);var c=e.Util.extendSymbol(i,{});c&&l.setSymbol(c),n.updateSymbol({lineOpacity:0})}l&&(l.setCoordinates(s),l._setPrjCoordinates(a),n.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return r.length>3&&(r=r.slice(0,3)),new H(r,{symbol:e})}}),t.StraightArrow=O,t.DiagonalArrow=T,t.DoveTailDiagonalArrow=N,t.DoubleArrow=G,t.ClosedCurve=q,t.Sector=H,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.4.2, requires maptalks@>=0.44.1.")});