/*!
 * maptalks.plotsymbol v0.4.2
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
/*!
 * requires maptalks@>=0.44.1 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(t,e){this.x=t,this.y=e}function n(t,e){var r=t.add(e)._unit(),n=1/(r.x*e.x+r.y*e.y);return r._mult(n)}function o(t,e,r){var n=e.x*r,o=e.y*r;return[t.add(n,o),t.add(-n,-o)]}var i=r;r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,o=r*this.x+e*this.y;return this.x=n,this.y=o,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),o=e.x+r*(this.x-e.x)-n*(this.y-e.y),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t};var a=Math.PI/2,s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=e.Coordinate,c=e.Canvas,p=function(t,e,r,a,s){e/=2;for(var u=void 0,l=0,h=[],c=[],p=void 0,y=void 0,f=void 0,d=void 0,v=void 0,g=void 0,m=1,w=t.length;m<w;m++)y=new i(t[m].x,t[m].y),f=new i(t[m-1].x,t[m-1].y),u=a&&s?(1-(1-a)*(l+=y.dist(f))/s)*e:e,d=m<w-1?new i(t[m+1].x,t[m+1].y):null,v=y.sub(f)._unit()._perp(),1===m&&(p=o(t[m-1],v,e),h.push(p[0]),c.push(p[1])),g=d?n(v,d.sub(y)._unit()._perp()):v,isNaN(g.x)||isNaN(g.y)||(p=o(t[m],g,u),h.push(p[0]),c.push(p[1]));return[h,c]},y=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},f=function(t){var e=0;return t&&Array.isArray(t)&&t.length>0&&t.forEach(function(r,n){n<t.length-1&&(e+=y(r,t[n+1]))}),e},d=function(t){return Math.pow(f(t),.99)},v=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},g=function(t,e){var r=void 0,n=Math.asin(Math.abs(e[1]-t[1])/y(t,e));return e[1]>=t[1]&&e[0]>=t[0]?r=n+Math.PI:e[1]>=t[1]&&e[0]<t[0]?r=2*Math.PI-n:e[1]<t[1]&&e[0]<t[0]?r=n:e[1]<t[1]&&e[0]>=t[0]&&(r=Math.PI-n),r},m=function(t,e,r){var n=g(e,t)-g(e,r);return n<0?n+2*Math.PI:n},w=function(t,e,r){return(r[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(r[0]-t[0])},P=function(t,e,r,n,o){var i=1-(t=Math.max(Math.min(t,1),0)),a=t*t,s=a*t,u=i*i,l=u*i;return[l*e[0]+3*u*t*r[0]+3*i*a*n[0]+s*o[0],l*e[1]+3*u*t*r[1]+3*i*a*n[1]+s*o[1]]},x=function(t,e,r,n,o){var i=g(t,e),a=o?i+r:i-r,s=n*Math.cos(a),u=n*Math.sin(a);return[e[0]+s,e[1]+u]},_=function(t,e,r,n){var o=function(t,e,r){var n=t[0]-e[0],o=t[1]-e[1],i=Math.sqrt(n*n+o*o);n/=i,o/=i;var a=r[0]-e[0],s=r[1]-e[1],u=Math.sqrt(a*a+s*s);return[n+(a/=u),o+(s/=u)]}(e,r,n),i=null,a=null,s=null,u=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=o[0]/u,h=o[1]/u,c=y(e,r),p=y(r,n);return u>1e-4?w(e,r,n)?(s=t*c,i=[r[0]-s*h,r[1]+s*l],s=t*p,a=[r[0]+s*h,r[1]-s*l]):(s=t*c,i=[r[0]+s*h,r[1]-s*l],s=t*p,a=[r[0]-s*h,r[1]+s*l]):(i=[r[0]+t*(e[0]-r[0]),r[1]+t*(e[1]-r[1])],a=[r[0]+t*(n[0]-r[0]),r[1]+t*(n[1]-r[1])]),[i,a]},b=function(t){var e=1;switch(t){case t<=1:e=1;break;case 2===t:e=2;break;case 3===t:e=6;break;case 24===t:e=24;break;case 5===t:e=120;break;default:for(var r=1;r<=t;r++)e*=r}return e},M=function(t,e){return b(t)/(b(e)*b(t-e))},S=function(t){if(t.length<=2)return t;for(var e=[],r=t.length-1,n=0;n<=1;n+=.01){for(var o=0,i=0,a=0;a<=r;a++){var s=M(r,a),u=Math.pow(n,a),l=Math.pow(1-n,r-a);o+=s*u*l*t[a][0],i+=s*u*l*t[a][1]}e.push([o,i])}return e.push(t[r]),e},C=function(t,r,n,o,a,s,u,l){function h(t,e,r,n,o,i,a,s,u,l){var h=(t+r)/2,c=(e+n)/2,p=(r+o)/2,y=(n+i)/2,f=(o+a)/2,d=(i+s)/2,v=Math.sqrt((r-t)*(r-t)+(n-e)*(n-e)),g=Math.sqrt((o-r)*(o-r)+(i-n)*(i-n)),m=v/(v+g),w=g/(g+Math.sqrt((a-o)*(a-o)+(s-i)*(s-i))),P=h+(p-h)*m,x=c+(y-c)*m,_=p+(f-p)*w,b=y+(d-y)*w,M=P+(p-P)*u+r-P,S=x+(y-x)*u+n-x,C=_+(p-_)*u+o-_,A=b+(y-b)*u+i-b,O=[M,S,C,A];return l<1?function(t,e,r,n,o,i,a,s,u,l){var h=1-t,c=1-e,p=r*c*c+2*o*e*c+a*e*e,y=o*c*c+2*a*e*c+u*e*e,f=n*c*c+2*i*e*c+s*e*e,d=i*c*c+2*s*e*c+l*e*e;return[(r*h*h+2*o*t*h+a*t*t)*c+(o*h*h+2*a*t*h+u*t*t)*e,(n*h*h+2*i*t*h+s*t*t)*c+(i*h*h+2*s*t*h+l*t*t)*e,p*h+y*t,f*h+d*t,p*c+y*e,f*c+d*e]}(0,l,r,n,M,S,C,A,o,i):O}if(!r)return null;if(r.length<=2||!o)return a&&function(t,r,n,o,i){e.Util.isArrayHasData(r)&&(c._path(t,r,i,n),c._stroke(t,n))}(t,r,n),null;var p=r.length,y=s?p:p-1;void 0!==l&&(y-=Math.max(y-u-1,0));for(var f=void 0,d=0;d<y;d++){var v=r[d].x,g=r[d].y,m=void 0,w=void 0,P=void 0,x=void 0,_=void 0,b=void 0;d-1<0?s?(m=r[y-1].x,w=r[y-1].y):(m=r[d+1].x,w=r[d+1].y):(m=r[d-1].x,w=r[d-1].y),d+1<p?(P=r[d+1].x,x=r[d+1].y):(P=r[d+1-p].x,x=r[d+1-p].y),d+2<p?(_=r[d+2].x,b=r[d+2].y):s?(_=r[d+2-p].x,b=r[d+2-p].y):(_=r[d].x,b=r[d].y);var M=h(m,w,v,g,P,x,_,b,o,d===y-1?l:1);if(d===y-1&&l>=0&&l<1){t&&t.bezierCurveTo(M[0],M[1],M[2],M[3],M[4],M[5]),r.splice(y-1,p-(y-1)-1);var S=new i(M[4],M[5]);S.prevCtrlPoint=new i(M[2],M[3]),r.push(S),p=r.length}else t&&t.bezierCurveTo(M[0],M[1],M[2],M[3],P,x);r[d].nextCtrlPoint=M.slice(0,2),r[d].prevCtrlPoint=f?f.slice(2):null,f=M}return!s&&r[1].prevCtrlPoint&&(r[0].nextCtrlPoint=r[1].prevCtrlPoint,delete r[0].prevCtrlPoint),r[p-1].prevCtrlPoint||(r[p-1].prevCtrlPoint=r[p-2].nextCtrlPoint),a&&c._stroke(t,n),r},A={widthRatio:.1,arrowStyle:[],tailWidthFactor:.1,headWidthFactor:1,neckWidthFactor:.2,headAngle:Math.PI/8.5,neckAngle:Math.PI/13},O=function(t){function r(){return s(this,r),l(this,t.apply(this,arguments))}return u(r,t),r.fromJSON=function(t){var e=t.feature,n=new r(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},r.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"StraightArrow"}},r.prototype.startEdit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.newVertexHandleSymbol={opacity:0},t.prototype.startEdit.call(this,e)},r.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),e=this._getPath2DPoints(this._getPrjCoordinates());if(e.length<=1)return null;var r=this._get2DLength()*this.options.widthRatio,n=p(e,r,this.getMap()),o=n[0][n[0].length-1],i=n[1][n[1].length-1],a=this._getArrowHead(o,i,e,r,1,.8,1.4,2.2,.7,2.3),s=[];s.push.apply(s,n[0]),s.push.apply(s,a);for(var u=n[1].length-1;u>=0;u--)s.push(n[1][u]);return s=s.map(function(e){return e.multi(t)}),[s,[n[0].length,a.length,n[1].length]]},r.prototype._paintOn=function(t,r,n,o,i,a){t.beginPath();var s=void 0,u=0;t.moveTo(r[0].x,r[0].y),s=r.slice(0,n[0]),C(t,s,o,.7,!0),u+=n[0],e.Canvas._path(t,r.slice(u,u+n[1]),a,o),u+=n[1],s=r.slice(u,u+n[2]),C(t,s,o,.7,!0),this._closeArrow(t,r[r.length-1],r[0]),e.Canvas._stroke(t,o),e.Canvas.fillCanvas(t,i,r[0].x,r[0].y)},r.prototype._closeArrow=function(t){t.closePath()},r.prototype._getArrowHead=function(t,r,n,o,i,a,s,u,l,h){var c=this._getArrowHeadPoint(t,r,n[n.length-1],o*i,a,u),p=new e.Point((c[0].x+c[1].x)/2,(c[0].y+c[1].y)/2),y=this._getArrowHeadPoint(c[0],c[1],p,o*i,s,l)[0],f=new e.Point((c[2].x+c[1].x)/2,(c[2].y+c[1].y)/2),d=this._getArrowHeadPoint(c[2],c[1],f,o*i,s,l)[0],v=void 0;if(2===n.length)v=[t,y,c[1],d,r];else{var g=C(null,n,null,.8,!1),m=new e.Point(g[g.length-1].prevCtrlPoint),w=n[n.length-1],P=w.sub(m);if(0===P.x&&0===P.y)return[t,y,c[1],d,r];var x=t.distanceTo(r),_=P.unit();v=[t,y,new e.Point(w.x+_.x*x*h,w.y+_.y*x*h),d,r]}return v},r.prototype._getArrowHeadPoint=function(t,e,r,n,o,a){a||(a=1),t=new i(t.x,t.y),e=new i(e.x,e.y);var s=t.sub(e)._unit(),u=r.add(n*s.x*o,n*s.y*o),l=r.add(n*-s.x*o,n*-s.y*o);s._perp()._mult(-1);return[u,r.add(a*n*s.x,a*n*s.y),l]},r}(e.Curve);O.mergeOptions(A),O.registerJSONType("StraightArrow"),e.DrawTool.registerMode("StraightArrow",{action:["click","mousemove","dblclick"],create:function(t){return new O(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var T=function(t){function e(){return s(this,e),l(this,t.apply(this,arguments))}return u(e,t),e.fromJSON=function(t){var r=t.feature,n=new e(r.geometry.coordinates,t.options);return n.setProperties(r.properties),n},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DiagonalArrow"}},e.prototype._getPaintParams=function(){var t=this._getPath2DPoints(this._getPrjCoordinates());if(t.length<=1)return null;var e=this.getMap().getGLScale(),r=this._get2DLength(),n=r*this.options.widthRatio,o=p(t,n,this.getMap(),.15,r),i=o[0][o[0].length-1],a=o[1][o[1].length-1],s=this._getArrowHead(i,a,t,n,.3,.6,1.4,2.2,.8,3.3),u=[];u.push.apply(u,o[0]),u.push.apply(u,s);for(var l=o[1].length-1;l>=0;l--)u.push(o[1][l]);return u=u.map(function(t){return t.multi(e)}),[u,[o[0].length,s.length,o[1].length]]},e}(O);T.mergeOptions({widthRatio:.2,arrowStyle:[]}),T.registerJSONType("DiagonalArrow"),e.DrawTool.registerMode("DiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new T(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var N=function(t){function e(){return s(this,e),l(this,t.apply(this,arguments))}return u(e,t),e.fromJSON=function(t){var r=t.feature,n=new e(r.geometry.coordinates,t.options);return n.setProperties(r.properties),n},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"DoveTailDiagonalArrow"}},e.prototype._closeArrow=function(t,e,r){var n=this.getMap().getPitch(),o=new i(e.x,e.y),a=new i(r.x,r.y),s=new i(o.x+a.x,o.y+a.y).mult(.5),u=o.dist(a),l=o.sub(a)._unit()._perp(),h=.618-.518*n/80,c=s.x+u*h*l.x,p=s.y+u*h*l.y;t.lineTo(c,p),t.closePath()},e}(T);N.mergeOptions({widthRatio:.2,arrowStyle:[]}),N.registerJSONType("DoveTailDiagonalArrow"),e.DrawTool.registerMode("DoveTailDiagonalArrow",{action:["click","mousemove","dblclick"],create:function(t){return new N(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}});var k=function(t){function r(){return s(this,r),l(this,t.apply(this,arguments))}return u(r,t),r.prototype.startEdit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.newVertexHandleSymbol={opacity:0},t.prototype.startEdit.call(this,e)},r.prototype._getPaintParams=function(){var t=this.getMap().getGLScale(),e=this._generate();if(!e)return null;if(!this._getProjection())return null;this._verifyProjection();var r=this._projectCoords(e),n=this._getPath2DPoints(r);return n=n.map(function(e){return e.multi(t)}),[n,[]]},r.prototype._paintOn=function(t,r,n,o,i){if(!(r.length<=0)){t.strokeStyle=this.getSymbol().lineColor||"#f00",t.beginPath(),t.moveTo(r[0].x,r[0].y);for(var a=1;a<r.length;a++)t.lineTo(r[a].x,r[a].y);t.closePath(),e.Canvas._stroke(t,o),e.Canvas.fillCanvas(t,i,r[0].x,r[0].y)}},r}(e.Curve),D=.25,J=.3,I=.85,G=.15,j=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=l(this,t.call(this,e,n));return o.type="DoubleArrow",o.connetPoints=[],o.symmetricalPoints=[],o}return u(r,t),r.prototype._generate=function(){var t=this.getCoordinates(),n=t.length,o=e.Coordinate.toNumberArrays(t);if(n<2)return null;if(2===n)return this.setCoordinates(t),null;var i=[o[0],o[1],o[2]],a=i[0],s=i[1],u=i[2];3===n?(this.symmetricalPoints=r.getSymmetricalPoints(a,s,u),this.connetPoints=v(a,s)):4===n?(this.symmetricalPoints=o[3],this.connetPoints=v(a,s)):n>4&&this._drawTool.disable();var l=void 0,h=void 0;w(a,s,u)?(l=r.getArrowPoints(a,this.connetPoints,this.symmetricalPoints,!1),h=r.getArrowPoints(this.connetPoints,s,u,!0)):(l=r.getArrowPoints(s,this.connetPoints,u,!1),h=r.getArrowPoints(this.connetPoints,a,this.symmetricalPoints,!0));var c=l.length,p=(c-5)/2,y=l.slice(0,p),f=l.slice(p,p+5),d=l.slice(p+5,c),g=h.slice(0,p),m=h.slice(p,p+5),P=h.slice(p+5,c);g=S(g);var x=S(P.concat(y.slice(1)));return d=S(d),g.concat(m,x,f,d).map(function(t){return new e.Coordinate(t)})},r.prototype.getPlotType=function(){return this.type},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"DoubleArrow",coordinates:n}},r.getArrowPoints=function(t,e,n,o){var i=v(t,e),s=y(i,n),u=x(n,i,0,.3*s,!0),l=x(n,i,0,.5*s,!0),h=[i,u=x(i,u,a,s/5,o),l=x(i,l,a,s/4,o),n],c=r._getArrowHeadPoints(h);if(c&&Array.isArray(c)&&c.length>0){var p=[c[0],c[4]],f=p[0],g=p[1],m=y(t,e)/d(h)/2,w=r._getArrowBodyPoints(h,f,g,m);if(w){var P=w.length,_=w.slice(0,P/2),b=w.slice(P/2,P);return _.push(f),b.push(g),(_=_.reverse()).push(e),(b=b.reverse()).push(t),_.reverse().concat(c,b)}}return null},r._getArrowHeadPoints=function(t){var e=d(t)*D,r=t[t.length-1],n=e*J,o=e*G,i=e*I,s=x(t[t.length-2],r,0,e,!0),u=x(t[t.length-2],r,0,i,!0),l=x(r,s,a,n,!1),h=x(r,s,a,n,!0);return[x(r,u,a,o,!1),l,r,h,x(r,u,a,o,!0)]},r._getArrowBodyPoints=function(t,e,r,n){for(var o=f(t),i=d(t)*n,a=(i-y(e,r))/2,s=0,u=[],l=[],h=1;h<t.length-1;h++){var c=m(t[h-1],t[h],t[h+1])/2,p=(i/2-(s+=y(t[h-1],t[h]))/o*a)/Math.sin(c),v=x(t[h-1],t[h],Math.PI-c,p,!0),g=x(t[h-1],t[h],c,p,!1);u.push(v),l.push(g)}return u.concat(l)},r.getSymmetricalPoints=function(t,e,r){var n=v(t,e),o=y(n,r),i=m(t,n,r),s=void 0,u=void 0,l=void 0,h=void 0;return i<a?(u=o*Math.sin(i),l=o*Math.cos(i),h=x(t,n,a,u,!1),s=x(n,h,a,l,!0)):i>=a&&i<Math.PI?(u=o*Math.sin(Math.PI-i),l=o*Math.cos(Math.PI-i),h=x(t,n,a,u,!1),s=x(n,h,a,l,!1)):i>=Math.PI&&i<1.5*Math.PI?(u=o*Math.sin(i-Math.PI),l=o*Math.cos(i-Math.PI),h=x(t,n,a,u,!0),s=x(n,h,a,l,!0)):(u=o*Math.sin(2*Math.PI-i),l=o*Math.cos(2*Math.PI-i),h=x(t,n,a,u,!0),s=x(n,h,a,l,!1)),s},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(k);j.registerJSONType("DoubleArrow"),e.DrawTool.registerMode("DoubleArrow",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,e,r){var n=e.getSymbol();e.setCoordinates(t);var o=e.getLayer();if(o){var i=o.getMap(),a=o.getGeometryById("doublearrow");!a&&t.length>=3&&((a=new j(t,{id:"doublearrow"}))._drawTool=r.drawTool||i._map_tool,a.addTo(o),n&&a.setSymbol(n),e.updateSymbol({lineOpacity:0})),a&&(a.setCoordinates(t),e.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return r.length>4&&(r=r.slice(0,4)),new j(r,{symbol:e})}});var q=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=l(this,t.call(this,e,n));return o.type="ClosedCurve",o._offset=.3,e&&o.setCoordinates(e),o}return u(r,t),r.prototype.getPlotType=function(){return this.type},r.prototype._generate=function(){var t=this.getCoordinates(),r=t.length;if(r<2)return null;if(2===r)return this.setCoordinates(t),null;var n=e.Coordinate.toNumberArrays(t);n.push(n[0],n[1]);for(var o=[],i=[],a=0;a<n.length-2;a++){var s=_(this._offset,n[a],n[a+1],n[a+2]);o=o.concat(s)}var u=o.length;o=[o[u-1]].concat(o.slice(0,u-1));for(var l=0;l<n.length-2;l++){var h=n[l],c=n[l+1];i.push(h);for(var p=0;p<=100;p++){var y=P(p/100,h,o[2*l],o[2*l+1],c);i.push(y)}i.push(c)}return i=i.map(function(t){return new e.Coordinate(t)})},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"ClosedCurve",coordinates:n}},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(k);q.registerJSONType("ClosedCurve"),e.DrawTool.registerMode("ClosedCurve",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,e){var r=e.getSymbol();e.setCoordinates(t);var n=e.getLayer();if(n){var o=n.getGeometryById("closedcurve");!o&&t.length>=3&&((o=new q([t],{id:"closedcurve"})).addTo(n),r&&o.setSymbol(r),e.updateSymbol({lineOpacity:0})),o&&(o.setCoordinates(t),e.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();return e.lineOpacity=1,new q(t.getCoordinates(),{symbol:e})}});var H=function(t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,r);var o=l(this,t.call(this,e,n));return o.type="Sector",e&&o.setCoordinates(e),o}return u(r,t),r.prototype.getPlotType=function(){return this.type},r.prototype._generate=function(){var t=[],r=this.getCoordinates(),n=r.length,o=e.Coordinate.toNumberArrays(r);if(n<=2)return this.setCoordinates(o),null;if(3===n){var i=[o[0],o[1],o[2]],a=i[0],s=i[1],u=i[2],l=this._getMeasurer(),c=function(t,e,r,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=null,s=null,u=o-n,l=[];u=u<0?u+2*Math.PI:u;for(var h=0;h<i;h++){var c=u*h/i+n;a=r*Math.cos(c),s=r*Math.sin(c);var p=t.locate({x:e[0],y:e[1]},a,s);l.push([p.x,p.y])}return l}(l,a,function(t,e,r){return t.measureLength(h.toCoordinates(e),h.toCoordinates(r))}(l,s,a),g(s,a),g(u,a));c.push(a,c[0]),t=c.map(function(t){return new e.Coordinate(t)})}else n>3&&this._drawTool.endDraw();return t},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:e.Coordinate.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var r=e.Util.extend({},t),n=this.getCoordinates();r.geometry=!1;var o=this.toGeoJSON(r);return o.geometry={type:"Polygon"},{feature:o,subType:"Sector",coordinates:n}},r.fromJSON=function(t){var e=t.feature,n=new r(t.coordinates,t.options);return n.setProperties(e.properties),n},r}(k);H.registerJSONType("Sector"),e.DrawTool.registerMode("Sector",{action:["click","mousemove","dblclick"],create:function(t){return new e.LineString(t)},update:function(t,r,n){var o=r.getSymbol();r.setCoordinates(t);var i=r.getLayer();if(i){var a=i.getMap(),s=i.getGeometryById("sector");if(!s&&t.length>=3){(s=new H(t,{id:"sector"}))._drawTool=n.drawTool||a._map_tool,s.addTo(i);var u=e.Util.extendSymbol(o,{});u&&s.setSymbol(u),r.updateSymbol({lineOpacity:0})}s&&(s.setCoordinates(t),r.updateSymbol({lineOpacity:0}))}},generate:function(t){var e=t.getSymbol();e.lineOpacity=1;var r=t.getCoordinates();return r.length>3&&(r=r.slice(0,3)),new H(r,{symbol:e})}}),t.StraightArrow=O,t.DiagonalArrow=T,t.DoveTailDiagonalArrow=N,t.DoubleArrow=j,t.ClosedCurve=q,t.Sector=H,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.plotsymbol v0.4.1, requires maptalks@>=0.44.1.")});